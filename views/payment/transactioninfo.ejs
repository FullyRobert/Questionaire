<!DOCTYPE html>
<html lang="en" data-textdirection="ltr" class="loading">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta name="description" content="Robust admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
  <meta name="keywords" content="admin template, robust admin template, dashboard template, flat admin template, responsive admin template, web app">
  <meta name="author" content="PIXINVENT">
  <title>订单详细信息</title>
  <link rel="apple-touch-icon" sizes="60x60" href="../app-assets/images/ico/apple-icon-60.png">
  <link rel="apple-touch-icon" sizes="76x76" href="../app-assets/images/ico/apple-icon-76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="../app-assets/images/ico/apple-icon-120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="../app-assets/images/ico/apple-icon-152.png">
  <link rel="shortcut icon" type="image/x-icon" href="../app-assets/images/ico/favicon.ico">
  <link rel="shortcut icon" type="image/png" href="../app-assets/images/ico/favicon-32.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <!-- BEGIN VENDOR CSS-->
  <link rel="stylesheet" type="text/css" href="../app-assets/css/bootstrap.css">
  <!-- font icons-->
  <link rel="stylesheet" type="text/css" href="../app-assets/fonts/icomoon.css">
  <link rel="stylesheet" type="text/css" href="../app-assets/fonts/flag-icon-css/css/flag-icon.min.css">
  <link rel="stylesheet" type="text/css" href="../app-assets/vendors/css/extensions/pace.css">
  <!-- END VENDOR CSS-->
  <!-- BEGIN ROBUST CSS-->
  <link rel="stylesheet" type="text/css" href="../app-assets/css/bootstrap-extended.css">
  <link rel="stylesheet" type="text/css" href="../app-assets/css/app.css">
  <link rel="stylesheet" type="text/css" href="../app-assets/css/colors.css">
  <!-- END ROBUST CSS-->
  <!-- BEGIN Page Level CSS-->
  <link rel="stylesheet" type="text/css" href="../app-assets/css/core/menu/menu-types/vertical-menu.css">
  <link rel="stylesheet" type="text/css" href="../app-assets/css/core/menu/menu-types/vertical-overlay-menu.css">
  <link rel="stylesheet" type="text/css" href="../app-assets/vendors/css/documentation.css">
  <!-- END Page Level CSS-->
  <!-- BEGIN Custom CSS-->
  <link rel="stylesheet" type="text/css" href="../../../assets/css/style.css">
  <!-- END Custom CSS-->
  <style type="text/css">
  	label {
  		font-weight: bold;
  	}
  </style>
</head>
<body data-open="click" data-menu="vertical-menu" data-col="2-columns" class="vertical-layout vertical-menu 2-columns  fixed-navbar">
  <!-- - var navbarCustom = "navbar-fixed-top navbar-semi-dark navbar-shadow"-->
  <!-- navbar-fixed-top-->
  <nav class="header-navbar navbar navbar-with-menu navbar-fixed-top navbar-semi-dark navbar-shadow">
    <div class="navbar-wrapper">
      <div class="navbar-header">
        <ul class="nav navbar-nav">
          <li class="nav-item"><a href="/book/bookhome" class="navbar-brand nav-link">在线支付系统</a></li>
          <li class="nav-item hidden-md-up float-xs-right"><a data-toggle="collapse" data-target="#navbar-mobile" class="nav-link open-navbar-container"><i class="icon-ellipsis pe-2x fa-rotate-90"></i></a></li>
        </ul>
      </div>
      <div class="navbar-container content">
        <div id="navbar-mobile" class="collapse navbar-toggleable-sm">
          <ul class="nav navbar-nav">
            <li class="nav-item hidden-sm-down"><a class="nav-link nav-menu-main menu-toggle hidden-xs"><i class="icon-menu5"></i></a></li>
          </ul>
          <ul class="nav navbar-nav float-xs-right">
            <li class="nav-item"><a href="javascript:void(0);" onclick="javascript:history.back(-1);" class="btn btn-success btn-doc-header"><i class="icon-bag3"></i>返回</a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- ////////////////////////////////////////////////////////////////////////////-->
  <!-- main menu-->
  <div data-scroll-to-active="true" class="main-menu menu-fixed menu-dark menu-accordion menu-shadow">
    <!-- main menu header-->
    <!-- / main menu header-->
    <!-- main menu content-->
    <div class="main-menu-content menu-accordion">
      <ul id="main-menu-navigation" data-menu="menu-navigation" class="navigation navigation-main">
        <li class="nav-item">
          <a href="/account/balance"><i class="icon-home3"></i><span data-i18n="" class="menu-title">我的账户</span></a>
        </li>
        <li class="nav-item">
          <a href="/book/hotel_hotelsearch"><i class="icon-android-menu"></i><span data-i18n="" class="menu-title">在线预定</span></a>
        </li>
        <li class="active">
          <a href="/payment"><i class="icon-folder3"></i><span data-i18n="" class="menu-title">我的订单</span></a>
        </li>
      </ul>
    </div>
    <!-- /main menu content-->
    <!-- main menu footer-->
    <!-- main menu footer-->
  </div>
  <!-- / main menu-->


  <div class="app-content content container-fluid">
    <div class="content-wrapper">
      <div class="content-header row">
      </div>
      <div class="content-body">
        <!-- Overview -->
        <div class="card">
          <div class="card-header">
            <h4 id="basic-forms" class="card-title">详细信息</h4>
          </div>
          <div class="card-body collapse in" aria-expanded="true">
            <div class="card-block">
              <div class="table-responsive">
                <table class="table table-hover">
                  <tbody>
                    <tr>
                      <td>订单号</td>
                      <td><%= details.order_id %></td>
                    </tr>
                    <tr>
                      <td>商品名称</td>
                      <td><%= details.goods_name %></td>
                    </tr>
                    <tr>
                      <td>价格</td>
                      <td><%= details.price %></td>
                    </tr>
                    <tr>
                      <td>卖家</td>
                      <td><%= details.seller_name %></td>
                    </tr>
                    <tr>
                      <td>买家</td>
                      <td><%= username %></td>
                    </tr>
                    <tr>
                      <td>收货地址</td>
                      <td><%= details.receive_adr %></td>
                    </tr>
                    <tr>
                      <td>订单创建时间</td>
                      <td><%= dateFormat(details.created_time) %></td>
                    </tr>
                    <tr>
                      <td>当前状态</td>
                      <% if (details.current_status == 0) {%>
                      	<td>待付款</td>
                      <% } else if (details.current_status == 1) { %>
                      	<td>待发货</td>
                      <% } else if (details.current_status == 2) { %>
                      	<td>待收货</td>
                      <% } else if (details.current_status == 3) { %>
                      	<td>已完成</td>
                      <% } else if (details.current_status == 4) { %>
                      	<td>退款中</td>
                      <% } else if (details.current_status == 5) { %>
                      	<td>已关闭</td>
                      <% } %>
                    </tr>
                    <% if (details.current_status >= 3 && details.current_status <= 5) { %>
                    	<% if (details.refund_status >= 1 && details.refund_status <= 3) { %>
		                    <tr>
		                    	<td>退款申请理由</td>
		                    	<td><%= details.refund_reason %></td>
		                    </tr>
		                    <tr>
		                    	<td>退款状态</td>
		                    	<% if (details.refund_status == 1) { %>
		                    		<td>待审核</td>
		                    	<% } else if (details.refund_status == 2) { %>
		                    		<td>退款成功</td>
		                    	<% } else if (details.refund_status == 3) { %>
														<td>退款失败</td>
													<% } %>
		                    </tr>
		                    <% if (details.refund_status == 2) { %>
			                    <tr>
			                    	<td>退款时间</td>
			                    	<td><%= dateFormat(details.refund_time) %></td>
			                    </tr>
			                  <% } %>
		                  <% } %>
                    <% } %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <% if (details.current_status == 0) { %>
        <div class="card">
        	<div class="card-body">
        		<div class="card-header">
        			<h4 class="card-title">支付</h4>
        		</div>
        		<div>
        		<div class="card-block">
	      			<div class="form-body form-horizontal">
	      				<div class="form-group">
	      					<label>动态验证码</label>
	      					<div class="form-inline">
		      					<input type="text" class="form-control" name="dynamic" data-toggle="tooltip" data-trigger="hover" data-placement="top" data-title="请输入动态验证码">
		      					<img src="/payment/captcha" class="verify" />
		      				</div>
		      			</div>
		      			<div class="form-group">
		      				<label>支付密码</label>
		      				<div class="form-inline">
		      					<input type="password" class="form-control" name="paypwd" data-toggle="tooltip" data-trigger="hover" data-placement="top" data-title="请输入支付密码">
		      					<button class="btn btn-success btn-outline-primary" id="paybtn">确认支付</button>
		      				</div>
		      			</div>
	      			</div>
      			</div>
        	</div>
        </div>
        <% } %>

        <% if (details.current_status == 3) { %>
	        <div class="card">
	          <div class="card-body">
		          <div class="card-header">
		            <h4 class="card-title">申请退款</h4>
		          </div>
	            <div class="card-block">
	              <form class="form" action="/payment/applyRefund" method="post">
	                <div class="form-body">
	                    <textarea name="refund_reason" class="form-control square" rows="5" maxlength="200"></textarea>
	                    <div class="form-actions center">
	                  		<button class="btn btn-success btn-outline-primary" type="submit">提交退款申请</button>
	                		</div>
	                		<input type="hidden" name="pos" value="<%= session %>">
	                </div>
	              </form>
	            </div>
	          </div>
	        </div>
        <% } %>

        <% if (details.current_status > 0) { %>
        <div class="card">
        	<div class="card-body">
		        <div class="card-header">
		        	<h4 class="card-title">投诉</h4>
		        </div>
		        <div class="card-block">
		        	<form class="form" action="/payment/complain" method="post">
		        		<div class="form-body">
		        			<textarea name="complain" class="form-control square" rows="5" maxlength="200"><%= details.complain %> </textarea>
		        			<br/>
		        			<% if (details.complain_time) { %>
		        				<label class=""><strong>上次投诉时间：</strong><%= dateFormat(details.complain_time) %></label>
		        			<% } %>
		        			<div class="form-actions center">
		        				<button class="btn btn-success btn-outline-primary" type="submit">提交投诉理由</button>
		        				<input type="hidden" name="pos" value="<%= session %>">
		        			</div>
		        		</div>
		        	</form>
		        </div>
		      </div>
		    </div>
		    <% } %>

      </div>
    </div>
  </div>

  <!-- BEGIN VENDOR JS-->
  <script src="../app-assets/js/core/libraries/jquery.min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/tether.min.js" type="text/javascript"></script>
  <script src="../app-assets/js/core/libraries/bootstrap.min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/unison.min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/blockUI.min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/jquery.matchHeight-min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/screenfull.min.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/extensions/pace.min.js" type="text/javascript"></script>
  <!-- BEGIN VENDOR JS-->
  <!-- BEGIN PAGE VENDOR JS-->
  <!-- END PAGE VENDOR JS-->
  <!-- BEGIN ROBUST JS-->
  <script src="../app-assets/js/core/app-menu.js" type="text/javascript"></script>
  <script src="../app-assets/js/core/app.js" type="text/javascript"></script>
  <!-- END ROBUST JS-->
  <!-- BEGIN PAGE LEVEL JS-->
  <script src="../app-assets/js/scripts/documentation.js" type="text/javascript"></script>
  <script src="../app-assets/vendors/js/ui/affix.js" type="text/javascript"></script>
  <!-- END PAGE LEVEL JS-->

  <script>
  	$(".verify").click(function(){
			$(event.target).attr('src','/payment/captcha?'+Math.random());
  	});
  	$("#paybtn").click(function(){
  		$.ajax({
  			type: "POST",
  			url: "/payment/captcha",
  			data: {
  				dynamic: $("input[name='dynamic']").val(),
  				paypwd: $("input[name='paypwd']").val(),
          order_id: "<%= details.order_id %>"  //不能加密，防止其他人得到加密方式，明文后端二次确认即可
  			},
  			dataType: "JSON",
  			success: function(data){
  				if (data.status == 500) {
            alert("验证码不对哦！");
  					$("img").attr('src','/payment/captcha?'+Math.random()); //更换验证码
  					$("input[name='dynamic']").val("");
  					$("input[name='paypwd']").val("");
  				} else if (data.status == 502) {
  					alert("支付密码错误!")
  				} else if (data.status == 200) {
            alert("支付成功，当前余额：" + data.balance);
            window.location.href = '/payment';
          } else {
            alert("其他错误，请联系系统管理员！");
          }
        }
  		});
  	});
  </script>

</body>
</html>